{% set calling_template = "challenges.html" %}
{% extends "base.html" %}

{% block content %}
<div id="cloud-container"><div id="cloud-container-inner"></div></div>

<div x-data="ChallengeBoard" 
  style="display: flex; height: 100%; overflow: hidden; position: relative;"
  @load-challenges.window="loadChallenges()"
  @load-challenge.window="loadChallenge($event.detail)">
  <div x-ref="challengeWindow" id="challenge-window" 
    class="modal fade" tabindex="-1" role="dialog"
    x-html="$store.challenge.data.view"></div>

  <div x-show="!loaded">
    <div class="min-vh-50 d-flex align-items-center">
      <div class="text-center w-100">
        <i class="fas fa-circle-notch fa-spin fa-3x fa-fw spinner"></i>
      </div>
    </div>
  </div>

  <div x-show="loaded" class="center-container">
    <div class="control-panel" x-data="fuzzyFinder">
      <h2>DÃ©fis</h2>
      <div class="fuzzy-finder" @keydown.window="handleKeydown">
        <input x-model="query" x-ref="input" @input="handleInput" @focus="handleFocus" @blur="handleBlur" type="text"
          placeholder="Rechercher ..." class="search-input" id="search-input" />
        <div x-show="showSuggestions && suggestions.length > 0" x-transition x-ref="fuzzyContainer" class="suggestions">
          <template x-for="(suggestion, idx) in suggestions" :key="idx">
            <div class="suggestion-item" :class="{ 'selected': idx === selectedIdx }"
              @click="selectSuggestion(suggestion)">
              <span x-text="suggestion.text"></span>
              <span class="suggestion-badge" :class="suggestion.type" x-text="suggestion.name"></span>
            </div>
          </template>
        </div>
      </div>
      <div id="chal-tree" class="chal-tree" x-data="{ tree: getChalTree() }" @load-challenges="tree = getChalTree(); console.log(tree);">
        <template x-for="[category, chals] of Object.entries(getChalTree())" :key="category">
          <div class="category-node">
            <div class="category-header" @click="toggleCategory(category)">
              <i class="collapse-icon fa-solid fa-plane" :class="{ 'expanded': !collapsedCategories[category] }"></i>
              <span x-text="category" class="category-name"></span>
            </div>

            <ul x-show="!collapsedCategories[category]" class="category-content">
              <template x-for="chal in chals" :key="chal.id">
                <li :class="{
                    [`chal-item ${getScoreLevel(chal.score)}`]: true,
                    'completed': chal.completed
                  }" :value="chal.id" @click="loadChallenge(chal.id)">
                  <div class="chal-header">
                    <div class="scored-badge" :class="{ 'badge-completed': chal.completed }">
                      <span x-text="chal.score"></span>
                      <svg fill="currentColor" height="30px" width="30px"  
                        viewBox="0 0 170.024 170.024" xml:space="preserve">
                        <path d="M167.524,170.024h-9.758c-1.381,0-2.5-1.119-2.5-2.5c0-4.223-3.436-7.658-7.658-7.658s-7.657,3.436-7.657,7.658
                          c0,1.381-1.119,2.5-2.5,2.5H126.98c-1.381,0-2.5-1.119-2.5-2.5c0-4.223-3.436-7.658-7.658-7.658s-7.657,3.436-7.657,7.658
                          c0,1.381-1.119,2.5-2.5,2.5H96.194c-1.381,0-2.5-1.119-2.5-2.5c0-4.223-3.435-7.658-7.657-7.658s-7.658,3.436-7.658,7.658
                          c0,1.381-1.119,2.5-2.5,2.5h-10.47c-1.381,0-2.5-1.119-2.5-2.5c0-4.223-3.436-7.658-7.658-7.658s-7.657,3.436-7.657,7.658
                          c0,1.381-1.119,2.5-2.5,2.5H34.623c-1.381,0-2.5-1.119-2.5-2.5c0-4.223-3.435-7.658-7.657-7.658s-7.658,3.436-7.658,7.658
                          c0,1.381-1.119,2.5-2.5,2.5H2.5c-1.381,0-2.5-1.119-2.5-2.5v-10.783c0-1.381,1.119-2.5,2.5-2.5c4.223,0,7.657-3.435,7.657-7.657
                          s-3.435-7.658-7.657-7.658c-1.381,0-2.5-1.119-2.5-2.5v-10.47c0-1.381,1.119-2.5,2.5-2.5c4.223,0,7.657-3.436,7.657-7.658
                          s-3.435-7.657-7.657-7.657c-1.381,0-2.5-1.119-2.5-2.5V95.17c0-1.381,1.119-2.5,2.5-2.5c4.223,0,7.657-3.436,7.657-7.658
                          S6.723,77.354,2.5,77.354c-1.381,0-2.5-1.119-2.5-2.5V64.384c0-1.381,1.119-2.5,2.5-2.5c4.223,0,7.657-3.435,7.657-7.657
                          S6.723,46.568,2.5,46.568c-1.381,0-2.5-1.119-2.5-2.5v-10.47c0-1.381,1.119-2.5,2.5-2.5c4.223,0,7.657-3.436,7.657-7.658
                          S6.723,15.783,2.5,15.783c-1.381,0-2.5-1.119-2.5-2.5V2.5C0,1.119,1.12,0,2.5,0h11.807c1.381,0,2.5,1.119,2.5,2.5
                          c0,4.223,3.436,7.658,7.658,7.658s7.657-3.436,7.657-7.658c0-1.381,1.119-2.5,2.5-2.5h10.471c1.381,0,2.5,1.119,2.5,2.5
                          c0,4.223,3.435,7.658,7.657,7.658s7.658-3.436,7.658-7.658c0-1.381,1.119-2.5,2.5-2.5h10.47c1.381,0,2.5,1.119,2.5,2.5
                          c0,4.223,3.436,7.658,7.658,7.658s7.657-3.436,7.657-7.658c0-1.381,1.119-2.5,2.5-2.5h10.471c1.381,0,2.5,1.119,2.5,2.5
                          c0,4.223,3.435,7.658,7.657,7.658s7.658-3.436,7.658-7.658c0-1.381,1.119-2.5,2.5-2.5h10.471c1.381,0,2.5,1.119,2.5,2.5
                          c0,4.223,3.435,7.658,7.657,7.658s7.658-3.436,7.658-7.658c0-1.381,1.119-2.5,2.5-2.5h9.758c1.381,0,2.5,1.119,2.5,2.5v10.783
                          c0,1.381-1.119,2.5-2.5,2.5c-4.223,0-7.657,3.435-7.657,7.657s3.435,7.658,7.657,7.658c1.381,0,2.5,1.119,2.5,2.5v10.47
                          c0,1.381-1.119,2.5-2.5,2.5c-4.223,0-7.657,3.436-7.657,7.658s3.435,7.657,7.657,7.657c1.381,0,2.5,1.119,2.5,2.5v10.471
                          c0,1.381-1.119,2.5-2.5,2.5c-4.223,0-7.657,3.435-7.657,7.657s3.435,7.658,7.657,7.658c1.381,0,2.5,1.119,2.5,2.5v10.471
                          c0,1.381-1.119,2.5-2.5,2.5c-4.223,0-7.657,3.435-7.657,7.657s3.435,7.658,7.657,7.658c1.381,0,2.5,1.119,2.5,2.5v10.47
                          c0,1.381-1.119,2.5-2.5,2.5c-4.223,0-7.657,3.436-7.657,7.658s3.435,7.657,7.657,7.657c1.381,0,2.5,1.119,2.5,2.5v10.783
                          C170.024,168.905,168.905,170.024,167.524,170.024z M160.018,165.024h5.006v-6.031c-5.786-1.164-10.157-6.286-10.157-12.409
                          c0-6.124,4.371-11.246,10.157-12.41v-5.966c-5.786-1.164-10.157-6.286-10.157-12.41c0-6.123,4.371-11.245,10.157-12.409v-5.967
                          c-5.786-1.164-10.157-6.286-10.157-12.41c0-6.123,4.371-11.245,10.157-12.409v-5.967c-5.786-1.164-10.157-6.286-10.157-12.409
                          c0-6.124,4.371-11.246,10.157-12.41v-5.966c-5.786-1.164-10.157-6.286-10.157-12.41c0-6.123,4.371-11.245,10.157-12.409V5h-5.006
                          c-1.163,5.787-6.286,10.158-12.41,10.158S136.362,10.787,135.199,5h-5.967c-1.163,5.787-6.286,10.158-12.41,10.158
                          S105.576,10.787,104.413,5h-5.967c-1.163,5.787-6.285,10.158-12.409,10.158S74.79,10.787,73.626,5h-5.966
                          c-1.163,5.787-6.286,10.158-12.41,10.158S44.004,10.787,42.841,5h-5.967c-1.163,5.787-6.285,10.158-12.409,10.158
                          S13.218,10.787,12.055,5H5v6.031c5.786,1.164,10.157,6.286,10.157,12.409c0,6.124-4.371,11.246-10.157,12.41v5.966
                          c5.786,1.164,10.157,6.286,10.157,12.41c0,6.123-4.371,11.245-10.157,12.409v5.967c5.786,1.164,10.157,6.286,10.157,12.409
                          c0,6.124-4.371,11.246-10.157,12.41v5.967c5.786,1.164,10.157,6.286,10.157,12.409c0,6.124-4.371,11.246-10.157,12.41v5.966
                          c5.786,1.164,10.157,6.286,10.157,12.41c0,6.123-4.371,11.245-10.157,12.409v6.031h7.055c1.163-5.787,6.286-10.158,12.41-10.158
                          s11.246,4.371,12.409,10.158h5.967c1.163-5.787,6.285-10.158,12.409-10.158s11.247,4.371,12.41,10.158h5.966
                          c1.163-5.787,6.286-10.158,12.41-10.158s11.246,4.371,12.409,10.158h5.967c1.163-5.787,6.285-10.158,12.409-10.158
                          s11.247,4.371,12.41,10.158h5.967c1.163-5.787,6.285-10.158,12.409-10.158S158.855,159.237,160.018,165.024z M146.583,149.084
                          H23.441c-1.381,0-2.5-1.119-2.5-2.5V23.44c0-1.381,1.119-2.5,2.5-2.5h123.143c1.381,0,2.5,1.119,2.5,2.5v123.144
                          C149.083,147.965,147.964,149.084,146.583,149.084z M25.941,144.084h118.143V25.94H25.941V144.084z"/>
                      </svg>

                    </div>
                    <div class="data data-name" :data-patate="chal.name" style="font-weight: 900;"></div>
                    <div class="chal-header-sect"></div>
                    <div class="chal-header-sect data" :data-patate="chal.author"></div>
                    <div class="chal-header-sect data" :data-patate="chal.position"></div>
                    <div class="chal-header-sect"></div>
                  </div>
                </li>
              </template>
            </ul>
          </div>
        </template>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
  {{ Assets.js("assets/js/challenges.js") }}
  {{ Assets.js("assets/js/homepage.js") }}
{% endblock %}
